<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>お問い合わせ</title>

  <!-- Tailwind（開発用） -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme:{ extend:{
        colors:{ brandPurple:{50:'#f5f3ff',100:'#ede9fe',200:'#ddd6fe',300:'#c4b5fd',400:'#a78bfa',500:'#8b5cf6',600:'#7c3aed',700:'#6d28d9',800:'#5b21b6',900:'#4c1d95'}},
        fontFamily:{ body:['"Noto Sans JP"','ui-sans-serif','system-ui','sans-serif'] }
      }}
    }
  </script>

  <style>
    /* iOSの入力ズーム防止 */
    input, textarea, button, select { font-size:16px }

    /* ====== 横幅を“実表示幅”に強制 ====== */
    :root{
      --padL: max(4px, env(safe-area-inset-left));
      --padR: max(4px, env(safe-area-inset-right));
      --padB: max(4px, env(safe-area-inset-bottom));
    }
    html, body { margin:0; width:100%; max-width:none; overflow-x:hidden }
    /* どこかに残っている max-width を全て無効化 */
    :where(html, body, main, section, div){ max-width: none !important }

    /* スマホでは 100dvw から左右パディングを引いた幅を強制 */
    .edge {
      width: calc(100dvw - var(--padL) - var(--padR)) !important;
      margin-inline: 0 !important;
    }
    /* 端末回転や一部古い環境向けフォールバック */
    @supports not (width: 100dvw) {
      .edge { width: calc(100vw - var(--padL) - var(--padR)) !important; }
    }
    /* タブレット以上は中央寄せ */
    @media (min-width:768px){
      .edge { width: 720px !important; margin-left:auto !important; margin-right:auto !important; }
    }
  </style>
</head>

<body class="min-h-screen bg-[#98fb98] font-body text-gray-800 antialiased
             pl-[var(--padL)] pr-[var(--padR)] pb-[var(--padB)]">

  <!-- Hero -->
  <header class="text-center pt-3 pb-2">
    <div class="inline-flex items-center gap-2 rounded-full border border-black/10 bg-white/80 px-3 py-1 text-[11px]">
      <svg class="h-3.5 w-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="1.6" d="M4 6h16a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2Zm0 0 8 6 8-6"/></svg>
      Contact
    </div>
    <h1 class="mt-2 bg-gradient-to-r from-blue-500 to-brandPurple-500 bg-clip-text text-transparent text-[22px] sm:text-2xl font-extrabold">お問い合わせ</h1>
    <p class="mt-1 text-[13px] text-gray-700/90">ご質問・お見積り・ご相談など、お気軽にお送りください。</p>
  </header>

  <!-- Card（幅強制） -->
  <main class="mx-0">
    <div class="edge relative rounded-xl p-[1px]
                bg-gradient-to-br from-blue-500/60 to-brandPurple-500/60
                shadow-[0_8px_22px_rgba(2,6,23,.14)]">
      <section class="w-full rounded-[12px] bg-white ring-1 ring-black/10">
        <div class="bg-brandPurple-600 text-white px-4 py-3 rounded-t-[12px]">
          <h2 class="text-lg sm:text-xl font-bold text-center">お問い合わせフォーム</h2>
        </div>

        <div class="p-4 sm:p-6">
          <form id="contactForm" class="space-y-4" novalidate>
            <div>
              <label for="name" class="block text-[15px] font-semibold text-gray-700">お名前 <span class="text-gray-500 text-xs">(必須)</span></label>
              <input id="name" name="name" required autocomplete="name"
                     class="mt-1 w-full rounded-lg border border-gray-300 bg-white px-3 py-3 focus:outline-none focus:ring-2 focus:ring-brandPurple-400 focus:border-brandPurple-500"/>
            </div>
            <div>
              <label for="email" class="block text-[15px] font-semibold text-gray-700">メールアドレス <span class="text-gray-500 text-xs">(必須)</span></label>
              <input id="email" name="email" type="email" required autocomplete="email" inputmode="email"
                     class="mt-1 w-full rounded-lg border border-gray-300 bg-white px-3 py-3 focus:outline-none focus:ring-2 focus:ring-brandPurple-400 focus:border-brandPurple-500"/>
            </div>
            <div>
              <label for="subject" class="block text-[15px] font-semibold text-gray-700">件名 <span class="text-gray-500 text-xs">(任意)</span></label>
              <input id="subject" name="subject" autocomplete="off"
                     class="mt-1 w-full rounded-lg border border-gray-300 bg-white px-3 py-3 focus:outline-none focus:ring-2 focus:ring-brandPurple-400 focus:border-brandPurple-500"/>
            </div>
            <div>
              <label for="message" class="block text-[15px] font-semibold text-gray-700">お問い合わせ内容 <span class="text-gray-500 text-xs">(必須)</span></label>
              <textarea id="message" name="message" required rows="6"
                        class="mt-1 w-full min-h-[160px] resize-y rounded-lg border border-gray-300 bg-white px-3 py-3 focus:outline-none focus:ring-2 focus:ring-brandPurple-400 focus:border-brandPurple-500"></textarea>
            </div>

            <input type="text" id="website" name="website" class="hidden" tabindex="-1" autocomplete="off"/>

            <div class="space-y-2">
              <button id="submitBtn" type="submit"
                      class="w-full select-none rounded-lg bg-gradient-to-r from-blue-500 to-brandPurple-500 px-4 py-3 font-extrabold text-white shadow-md transition active:scale-[.98] disabled:opacity-60">
                <span class="inline-flex items-center justify-center gap-2">送信する
                  <span id="loader" class="hidden"><span class="inline-block h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"></span></span>
                </span>
              </button>
              <button type="reset" class="w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-3 font-semibold text-gray-800">クリア</button>
              <p id="status" class="min-h-[1.2em] text-sm text-gray-500"></p>
            </div>
          </form>

          <div id="msgOk" class="mt-3 hidden rounded-lg border border-green-200 bg-green-50 px-3 py-2 text-sm text-green-700">送信が完了しました。ありがとうございました。</div>
          <div id="msgNg" class="mt-3 hidden rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700">送信に失敗しました。時間をおいて再度お試しください。</div>

          <p class="mt-3 text-[13px] text-gray-600">※個人情報の取り扱いは
            <a href="#" target="_blank" rel="noopener" class="border-b border-dashed border-current text-gray-800">プライバシーポリシー</a> をご確認ください。
          </p>

          <p id="ver" class="mt-1 text-center text-xs text-gray-500">ver: tw5</p>
        </div>
      </section>
    </div>
  </main>

  <script>
    // デバッグ表示：実際の幅を画面下に出す
    (function(){
      const v = document.getElementById('ver');
      function showSize(){
        const w = window.innerWidth;
        const vw = Math.round((window.visualViewport && window.visualViewport.width) || 0);
        const dpr = window.devicePixelRatio || 1;
        const edge = document.querySelector('.edge');
        const ew = edge ? Math.round(edge.getBoundingClientRect().width) : 0;
        v.textContent = `ver: tw5 | innerWidth:${w}px visualViewport:${vw || '-'}px DPR:${dpr} | card:${ew}px`;
      }
      showSize();
      window.addEventListener('resize', showSize);
    })();

    // 送信処理（前と同じ）
    (function(){
      const form=document.getElementById('contactForm');
      const btn=document.getElementById('submitBtn');
      const loader=document.getElementById('loader');
      const msgOk=document.getElementById('msgOk');
      const msgNg=document.getElementById('msgNg');
      const status=document.getElementById('status');
      function show(e){ e.classList.remove('hidden') } function hide(e){ e.classList.add('hidden') }
      function busy(b){ btn.disabled=b; if(b){show(loader); status.textContent='送信中…'}else{hide(loader); status.textContent=''} }
      form.addEventListener('submit',function(e){
        e.preventDefault(); hide(msgOk); hide(msgNg);
        if (document.getElementById('website').value.trim()!=='') return;
        const data={
          name:document.getElementById('name').value.trim(),
          email:document.getElementById('email').value.trim(),
          subject:document.getElementById('subject').value.trim(),
          message:document.getElementById('message').value.trim(),
          pageUrl:location.href, userAgent:navigator.userAgent
        };
        if(!data.name||!data.email||!data.message){ msgNg.textContent='必須項目が未入力です。'; show(msgNg); return; }
        if(!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(data.email)){ msgNg.textContent='メールアドレスの形式が正しくありません。'; show(msgNg); return; }
        busy(true);
        google.script.run.withSuccessHandler(function(res){ busy(false); if(res&&res.ok){ form.reset(); show(msgOk); } else{ show(msgNg); } })
                         .withFailureHandler(function(err){ console.error(err); busy(false); show(msgNg); })
                         .submitForm(data);
      });
    })();
  </script>
</body>
</html>
