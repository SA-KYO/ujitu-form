<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>お問い合わせ</title>

  <!-- Tailwind CDN（開発用） -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          /* brandPurple を“お茶グリーン”に置き換え（既存クラスのまま色相だけ変更） */
          colors: {
            brandPurple: {
              50:'#f3f7f1', 100:'#e8f2e6', 200:'#d6ead4', 300:'#c0dfbd',
              400:'#9fd39b', 500:'#7ec57d', 600:'#5eab61', 700:'#498a4c',
              800:'#3b7040', 900:'#325c35'
            }
          },
          fontFamily: { body: ['"Noto Sans JP"','ui-sans-serif','system-ui','sans-serif'] }
        }
      }
    }
  </script>

  <style>
    *,*::before,*::after{ box-sizing: border-box }
    /* iOS の自動ズーム防止 */
    input, textarea, button, select { font-size: 16px }

    /* Safe Area / 余白・幅 */
    :root{
      --padT: max(72px, calc(env(safe-area-inset-top) + 64px)); /* ノッチ回避+余白 */
      --padB: max(20px, env(safe-area-inset-bottom));
      --gap:  clamp(22px, 7.5vw, 34px);                        /* 左右外側余白 */
      --maxW: 920px;                                           /* PC上限幅 */
    }
    html, body { margin:0; width:100%; max-width:none; overflow-x:hidden }

    /* ビューポート幅に応じて中央寄せ */
    .edge{ width:min(var(--maxW), calc(100dvw - 2*var(--gap))); margin-left:auto; margin-right:auto; }
    @supports not (width: 100dvw){
      .edge{ width:min(var(--maxW), calc(100vw - 2*var(--gap))); }
    }

    /* 背景：茶畑の淡いグラデーション＋ほんのり紙っぽい明るさ */
    body{
      background:
        linear-gradient(180deg, #f7fbf6 0%, #eef6ee 45%, #e7f2e6 100%);
      background-attachment: fixed;
    }
  </style>
</head>

<body class="min-h-[100dvh] font-body text-gray-900 antialiased text-[17px] leading-relaxed
             pt-[var(--padT)] pb-[var(--padB)]">

  <!-- ヘッダー（中央） -->
  <header class="edge text-center mb-3">
    <h1 class="bg-gradient-to-r from-brandPurple-500 to-brandPurple-700 bg-clip-text text-transparent
               text-[26px] font-extrabold tracking-[.2px]">
      お問い合わせ
    </h1>
    <p class="mt-1 text-[15px] text-gray-700/90">ご質問・お見積り・ご相談など、お気軽にお送りください。</p>
  </header>

  <!-- フォームカード（中央寄せ） -->
  <main class="edge">
    <div class="rounded-xl p-[1px] bg-gradient-to-br from-brandPurple-300 to-brandPurple-600
                shadow-[0_8px_22px_rgba(34,84,53,.18)]">
      <section class="w-full rounded-[12px] bg-white ring-1 ring-black/10">
        <div class="bg-brandPurple-700 text-white px-4 py-3 rounded-t-[12px]">
          <h2 class="text-[18px] font-bold text-center">お問い合わせフォーム</h2>
        </div>

        <div class="p-4 sm:p-6">
          <form id="contactForm" class="space-y-4" novalidate>
            <div>
              <label for="name" class="block text-[16px] font-semibold text-gray-800">
                お名前 <span class="text-gray-500 text-[13px]">(必須)</span>
              </label>
              <input id="name" name="name" autocomplete="name" required
                     class="mt-1 w-full rounded-lg border border-gray-300 bg-white px-4 py-3.5 text-[17px]
                            focus:outline-none focus:ring-2 focus:ring-brandPurple-400 focus:border-brandPurple-500"/>
            </div>

            <div>
              <label for="email" class="block text-[16px] font-semibold text-gray-800">
                メールアドレス <span class="text-gray-500 text-[13px]">(必須)</span>
              </label>
              <input id="email" name="email" type="email" inputmode="email" autocomplete="email" required
                     class="mt-1 w-full rounded-lg border border-gray-300 bg-white px-4 py-3.5 text-[17px]
                            focus:outline-none focus:ring-2 focus:ring-brandPurple-400 focus:border-brandPurple-500"/>
            </div>

            <div>
              <label for="subject" class="block text-[16px] font-semibold text-gray-800">
                件名 <span class="text-gray-500 text-[13px]">(任意)</span>
              </label>
              <input id="subject" name="subject" autocomplete="off"
                     class="mt-1 w-full rounded-lg border border-gray-300 bg-white px-4 py-3.5 text-[17px]
                            focus:outline-none focus:ring-2 focus:ring-brandPurple-400 focus:border-brandPurple-500"/>
            </div>

            <div>
              <label for="message" class="block text-[16px] font-semibold text-gray-800">
                お問い合わせ内容 <span class="text-gray-500 text-[13px]">(必須)</span>
              </label>
              <textarea id="message" name="message" required rows="7"
                        class="mt-1 w-full rounded-lg border border-gray-300 bg-white px-4 py-3.5 text-[17px]
                               focus:outline-none focus:ring-2 focus:ring-brandPurple-400 focus:border-brandPurple-500
                               resize-y min-h-[180px]"></textarea>
            </div>

            <!-- 蜜壺（ボット対策） -->
            <input type="text" id="website" name="website" class="hidden" tabindex="-1" autocomplete="off"/>

            <div class="space-y-2">
              <button id="submitBtn" type="submit"
                      class="w-full select-none rounded-lg bg-gradient-to-r from-brandPurple-500 to-brandPurple-700
                             px-4 py-3.5 text-[17px] font-extrabold text-white shadow-md
                             transition active:scale-[.98] disabled:opacity-60">
                <span class="inline-flex items-center justify-center gap-2">
                  <span>送信する</span>
                  <span id="loader" class="hidden">
                    <span class="inline-block h-5 w-5 animate-spin rounded-full border-2 border-white border-t-transparent"></span>
                  </span>
                </span>
              </button>
              <button type="reset"
                      class="w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-3.5 text-[17px] font-semibold text-gray-900">
                クリア
              </button>
              <p id="status" class="min-h-[1.2em] text-[14px] text-gray-600"></p>
            </div>
          </form>

          <!-- トースト -->
          <div id="msgOk" class="mt-3 hidden rounded-lg border border-green-200 bg-green-50 px-3 py-2 text-[15px] text-green-700">
            送信が完了しました。ありがとうございました。
          </div>
          <div id="msgNg" class="mt-3 hidden rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-[15px] text-red-700">
            送信に失敗しました。時間をおいて再度お試しください。
          </div>

          <p class="mt-3 text-[14px] text-gray-700">
            ※個人情報の取り扱いは
            <a href="https://sa-kyo.github.io/privacy/" target="_blank" rel="noopener"
               class="border-b border-dashed border-current text-gray-900">プライバシーポリシー</a>
            をご確認ください。
          </p>
        </div>
      </section>
    </div>
  </main>

  <script>
    /* ★ここをあなたの GAS Webアプリ（/exec）URL に置き換え */
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyGicwAIdxRGU6eS8MztmziQMhllQOb1pnTdylsb-nqsyi_MPpj0hIMqYDerTjr9t5s0w/exec';

    // GASへ送信（プリフライト回避：no-cors + text/plain）
    async function postToGAS(payload){
      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'text/plain;charset=UTF-8' },
        body: JSON.stringify(payload)
      });
      // opaque 応答のため結果は読めないが、例外が出なければ成功扱い
      return { ok: true };
    }

    (function(){
      const form   = document.getElementById('contactForm');
      const btn    = document.getElementById('submitBtn');
      const loader = document.getElementById('loader');
      const msgOk  = document.getElementById('msgOk');
      const msgNg  = document.getElementById('msgNg');
      const status = document.getElementById('status');
      const show = el => el.classList.remove('hidden');
      const hide = el => el.classList.add('hidden');
      const busy = b => { btn.disabled = b; if(b){show(loader); status.textContent='送信中…'}else{hide(loader); status.textContent=''} };

      form.addEventListener('submit', async (e) => {
        e.preventDefault(); hide(msgOk); hide(msgNg);

        // 蜜壺（ボット対策）
        if (document.getElementById('website').value.trim() !== '') return;

        const data = {
          name:    document.getElementById('name').value.trim(),
          email:   document.getElementById('email').value.trim(),
          subject: document.getElementById('subject').value.trim(),
          message: document.getElementById('message').value.trim(),
          pageUrl: location.href,
          userAgent: navigator.userAgent,
          website: '' // サーバ側ハニーポット用フィールド
        };

        if (!data.name || !data.email || !data.message){
          msgNg.textContent = '必須項目が未入力です。'; show(msgNg); return;
        }
        if (!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(data.email)){
          msgNg.textContent = 'メールアドレスの形式が正しくありません。'; show(msgNg); return;
        }

        try{
          busy(true);
          const res = await postToGAS(data);
          busy(false);
          if (res.ok){ form.reset(); show(msgOk); } else { show(msgNg); }
        }catch(err){
          console.error(err); busy(false); show(msgNg);
        }
      });
    })();
  </script>
</body>
</html>
